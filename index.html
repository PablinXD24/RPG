<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Simplificado (M√©dia 5)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Tela de Login -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <h1>üé≤ D&D Simplificado</h1>
                <p class="subtitle">Sistema M√©dia 5</p>
            </div>
            
            <div class="login-form">
                <h2>Entrar</h2>
                <div class="form-group">
                    <label for="username">Usu√°rio</label>
                    <input type="text" id="username" placeholder="Ex: pablorpg">
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Senha">
                </div>
                <button id="login-btn" class="login-btn">Entrar</button>
                <div id="login-message" class="login-message"></div>
            </div>
            
            <div class="login-info">
                <p>Usu√°rios: pablorpg, pamela, joao, jaqueline, duda, dante</p>
                <p>Senha: RPG2025</p>
            </div>
        </div>
    </div>

    <!-- Aplica√ß√£o Principal (inicialmente oculta) -->
    <div id="main-app" class="main-app" style="display: none;">
        <div class="container">
            <header>
                <h1>üé≤ D&D Simplificado</h1>
                <div class="subtitle">Sistema M√©dia 5 - Mobile</div>
                <div class="user-info">
                    <span id="user-display">Usu√°rio</span>
                    <button id="logout-btn" class="logout-btn">Sair</button>
                </div>
            </header>
            
            <!-- Painel de Administra√ß√£o (apenas para pablorpg) -->
            <div id="admin-panel" class="admin-panel" style="display: none;">
                <div class="section-card">
                    <h2>üëë Painel de Administra√ß√£o</h2>
                    <div class="admin-form">
                        <h3>Adicionar Novo Usu√°rio</h3>
                        <div class="form-group">
                            <label for="new-username">Nome de Usu√°rio</label>
                            <input type="text" id="new-username" placeholder="Ex: novousuario">
                        </div>
                        <div class="form-group">
                            <label for="new-password">Senha</label>
                            <input type="password" id="new-password" placeholder="Senha">
                        </div>
                        <button id="add-user-btn" class="btn-primary">Adicionar Usu√°rio</button>
                        <div id="admin-message" class="admin-message"></div>
                    </div>
                </div>
            </div>
            
            <div class="content-area">
                <!-- Regras -->
                <div class="section-card rules-section">
                    <h2>üìñ Regras do Sistema</h2>
                    
                    <div class="rule-card">
                        <h3>üéØ Habilidades</h3>
                        <ul>
                            <li><strong>FOR</strong> - For√ßa</li>
                            <li><strong>CON</strong> - Constitui√ß√£o</li>
                            <li><strong>DES</strong> - Destreza</li>
                            <li><strong>MENTE</strong> - Intelig√™ncia/Sabedoria</li>
                            <li><strong>CAR</strong> - Carisma</li>
                        </ul>
                    </div>

                    <div class="rule-card">
                        <h3>üßÆ Modificadores</h3>
                        <p><strong>Modificador = Valor Final - 5</strong></p>
                        <p class="text-small">Ex: FOR 7 ‚Üí Mod +2</p>
                    </div>

                    <div class="rule-card">
                        <h3>‚ù§Ô∏è Pontos de Vida</h3>
                        <p><strong>PV = 10 + B√¥nus Classe + Mod. CON</strong></p>
                    </div>

                    <div class="rule-card">
                        <h3>üõ°Ô∏è Armaduras</h3>
                        <p class="text-small"><strong>Leve:</strong> CA +2, DES livre</p>
                        <p class="text-small"><strong>M√©dia:</strong> CA +4, DES +1</p>
                        <p class="text-small"><strong>Pesada:</strong> CA +6, DES +0</p>
                    </div>

                    <h3 class="mt-2">üë• Ra√ßas</h3>
                    <div class="compact-grid" id="race-grid">
                        <!-- Preenchido por JS -->
                    </div>

                    <h3 class="mt-2">‚öîÔ∏è Classes</h3>
                    <div class="compact-grid" id="class-grid">
                        <!-- Preenchido por JS -->
                    </div>
                </div>
                
                <!-- Personagem -->
                <div class="section-card character-section">
                    <h2>üë§ Criar Personagem</h2>
                    
                    <div class="rule-card">
                        <h3>1. Ra√ßa</h3>
                        <p id="selected-race" class="text-small">Nenhuma selecionada</p>
                        <div id="race-customization" style="display: none;"></div>
                    </div>

                    <div class="rule-card">
                        <h3>2. Classe</h3>
                        <p id="selected-class" class="text-small">Nenhuma selecionada</p>
                    </div>

                    <div class="rule-card">
                        <h3>3. Armadura</h3>
                        <select id="armor-select" onchange="updateCharacter()">
                            <option value="Nenhuma">Nenhuma</option>
                            <option value="Leve">Leve</option>
                            <option value="Media" selected>M√©dia</option>
                            <option value="Pesada">Pesada</option>
                        </select>
                    </div>

                    <div class="rule-card">
                        <h3>4. Atributos</h3>
                        <div class="attributes-grid" id="attributes-grid">
                            <!-- Preenchido por JS -->
                        </div>
                    </div>

                    <div class="character-sheet">
                        <h3>üìú Ficha</h3>
                        
                        <div class="sheet-row">
                            <span class="sheet-label">Ra√ßa:</span>
                            <span id="sheet-race">---</span>
                        </div>
                        <div class="sheet-row">
                            <span class="sheet-label">Classe:</span>
                            <span id="sheet-class">---</span>
                        </div>

                        <div class="combat-stats">
                            <div class="combat-stat">
                                <div class="stat-value" id="sheet-pv">---</div>
                                <div class="stat-label">PONTOS DE VIDA</div>
                            </div>
                            <div class="combat-stat">
                                <div class="stat-value" id="sheet-ca">---</div>
                                <div class="stat-label">CLASSE ARMADURA</div>
                            </div>
                        </div>

                        <div id="special-rule-container" class="mt-1"></div>

                        <button class="btn-primary" onclick="openCharacterTab()">
                            üé≤ Abrir Ficha Edit√°vel
                        </button>
                    </div>
                </div>

                <!-- Calculadora de Vida e Armadura -->
                <div class="section-card calculator-section">
                    <h2>üßÆ Calculadora R√°pida</h2>
                    <p class="text-small mb-2">Teste combina√ß√µes de ra√ßa, classe e armadura</p>
                    
                    <div class="calculator-grid">
                        <div>
                            <label class="sheet-label">Ra√ßa:</label>
                            <select id="calc-race-select" onchange="updateCalculator()">
                                <!-- Preenchido por JS -->
                            </select>
                        </div>
                        <div>
                            <label class="sheet-label">Classe:</label>
                            <select id="calc-class-select" onchange="updateCalculator()">
                                <!-- Preenchido por JS -->
                            </select>
                        </div>
                        <div>
                            <label class="sheet-label">Armadura:</label>
                            <select id="calc-armor-select" onchange="updateCalculator()">
                                <option value="Nenhuma">Nenhuma</option>
                                <option value="Leve">Leve</option>
                                <option value="Media" selected>M√©dia</option>
                                <option value="Pesada">Pesada</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="calculator-result pv-result">
                        <span>‚ù§Ô∏è PV Total:</span>
                        <span class="result-value" id="calc-pv-result">--</span>
                    </div>
                    
                    <div class="calculator-result ca-result">
                        <span>üõ°Ô∏è CA Final:</span>
                        <span class="result-value" id="calc-ca-result">--</span>
                    </div>

                    <div class="hp-calculation mt-2">
                        <h4>üìä Detalhes do C√°lculo</h4>
                        <div class="calculation-breakdown">
                            <div><strong>PV:</strong> 10 + B√¥nus Classe + Mod. CON</div>
                            <div><strong>CA:</strong> 10 + Mod. DES (limitado) + B√¥nus Armadura</div>
                        </div>
                    </div>
                </div>

                <!-- Sistema de Peso -->
                <div class="section-card weight-section">
                    <h2>‚öñÔ∏è Sistema de Peso</h2>
                    
                    <div class="rule-card">
                        <h3>üìä Carga</h3>
                        <p><strong>LMC = FOR√áA √ó 7.5 kg</strong></p>
                        <p class="text-small">Peso Total = Soma dos itens</p>
                    </div>

                    <div class="weight-info">
                        <div class="weight-stat">
                            <div class="stat-label">FOR√áA</div>
                            <div class="stat-value" id="weight-str">---</div>
                        </div>
                        <div class="weight-stat">
                            <div class="stat-label">LMC</div>
                            <div class="stat-value" id="weight-lmc">--- kg</div>
                        </div>
                        <div class="weight-stat">
                            <div class="stat-label">PESO</div>
                            <div class="stat-value" id="weight-current">--- kg</div>
                        </div>
                    </div>

                    <div class="weight-stat">
                        <div class="stat-label" id="weight-status">---</div>
                        <div class="weight-bar-container">
                            <div class="weight-bar" id="weight-bar"></div>
                        </div>
                        <div id="weight-penalty" class="text-xsmall mt-1"></div>
                    </div>

                    <div class="weight-limits">
                        <div class="weight-limit">
                            <h4>üèÉ Leve</h4>
                            <p class="text-small">At√© LMC √∑ 3</p>
                            <p class="text-xsmall" id="weight-light-example">--- kg</p>
                            <p class="text-xsmall">Sem penalidades</p>
                        </div>
                        <div class="weight-limit">
                            <h4>üö∂ M√©dio</h4>
                            <p class="text-small">At√© LMC √ó 2/3</p>
                            <p class="text-xsmall" id="weight-medium-example">--- kg</p>
                            <p class="text-xsmall">-3m movimento, -2 DES</p>
                        </div>
                        <div class="weight-limit">
                            <h4>üê¢ Pesado</h4>
                            <p class="text-small">At√© LMC</p>
                            <p class="text-xsmall" id="weight-heavy-example">--- kg</p>
                            <p class="text-xsmall">1.5m, desvantagem</p>
                        </div>
                        <div class="weight-limit">
                            <h4>üö´ Im√≥vel</h4>
                            <p class="text-small">Acima de LMC</p>
                            <p class="text-xsmall">N√£o pode se mover</p>
                        </div>
                    </div>

                    <div class="inventory-section">
                        <h3>üéí Invent√°rio</h3>
                        <div id="inventory-items" class="mb-1">
                            <div class="empty-inventory">
                                <p>üéÅ Invent√°rio vazio</p>
                                <p class="text-xsmall mt-1">Adicione itens usando o formul√°rio abaixo</p>
                            </div>
                        </div>
                        
                        <div class="add-item-form">
                            <input type="text" id="item-name" placeholder="Nome do item">
                            <input type="number" id="item-weight" placeholder="Peso (kg)" step="0.1" min="0">
                            <button onclick="addItem()">Adicionar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Nova Aba - Ficha de Personagem Edit√°vel -->
        <div class="character-tab" id="character-tab">
            <div class="container">
                <div class="tab-header">
                    <h1 class="tab-title">üìú Ficha Edit√°vel do Personagem</h1>
                    <button class="close-tab" onclick="closeCharacterTab()">‚úï Fechar</button>
                </div>

                <div class="character-sheet-detailed">
                    <div class="sheet-section">
                        <h3>üë§ Informa√ß√µes B√°sicas</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Nome:</span>
                                <input type="text" class="info-value editable" id="tab-name" value="Aventureiro" onchange="updateCharacterData()">
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ra√ßa:</span>
                                <span class="info-value" id="tab-race">---</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Classe:</span>
                                <span class="info-value" id="tab-class">---</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Armadura:</span>
                                <span class="info-value" id="tab-armor">---</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">N√≠vel:</span>
                                <input type="number" class="info-value editable" id="tab-level" value="1" min="1" max="20" onchange="updateCharacterData()">
                            </div>
                            <div class="info-item">
                                <span class="info-label">Experi√™ncia:</span>
                                <input type="number" class="info-value editable" id="tab-xp" value="0" min="0" onchange="updateCharacterData()">
                            </div>
                        </div>
                    </div>

                    <div class="sheet-section">
                        <h3>üéØ Atributos</h3>
                        <div class="attributes-detailed" id="attributes-detailed">
                            <!-- Preenchido por JS -->
                        </div>
                    </div>

                    <div class="sheet-section">
                        <h3>‚öîÔ∏è Combate</h3>
                        <div class="combat-stats-detailed">
                            <div class="combat-stat-detailed">
                                <input type="number" class="stat-value-detailed" id="tab-pv" value="10" min="0" onchange="updateCharacterData()">
                                <div class="stat-label-detailed">PONTOS DE VIDA</div>
                            </div>
                            <div class="combat-stat-detailed">
                                <input type="number" class="stat-value-detailed" id="tab-ca" value="10" min="0" onchange="updateCharacterData()">
                                <div class="stat-label-detailed">CLASSE ARMADURA</div>
                            </div>
                            <div class="combat-stat-detailed">
                                <input type="number" class="stat-value-detailed" id="tab-pv-max" value="10" min="0" onchange="updateCharacterData()">
                                <div class="stat-label-detailed">PV M√ÅXIMO</div>
                            </div>
                            <div class="combat-stat-detailed">
                                <input type="number" class="stat-value-detailed" id="tab-iniciativa" value="0" onchange="updateCharacterData()">
                                <div class="stat-label-detailed">INICIATIVA</div>
                            </div>
                        </div>
                    </div>

                    <div class="sheet-section">
                        <h3>‚ú® Habilidades Especiais</h3>
                        <div class="abilities-section" id="abilities-section">
                            <!-- Preenchido por JS -->
                        </div>
                    </div>

                    <div class="sheet-section">
                        <h3>üéí Invent√°rio</h3>
                        <div class="inventory-detailed" id="inventory-detailed">
                            <!-- Preenchido por JS -->
                        </div>
                        <div class="add-item-detailed">
                            <input type="text" id="new-item-name" placeholder="Nome do item">
                            <input type="number" id="new-item-weight" placeholder="Peso (kg)" step="0.1" min="0">
                            <button onclick="addItemDetailed()">+</button>
                        </div>
                    </div>

                    <div class="sheet-section">
                        <h3>üìù Anota√ß√µes</h3>
                        <div class="notes-section">
                            <textarea class="notes-textarea" id="tab-notes" placeholder="Anota√ß√µes sobre o personagem, miss√µes, tesouros, aliados, etc..." onchange="updateCharacterData()"></textarea>
                        </div>
                    </div>

                    <button class="save-button" onclick="saveCharacterData()">
                        üíæ Salvar Altera√ß√µes
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu Mobile -->
        <div class="mobile-menu">
            <button onclick="scrollToSection('rules')">
                üìñ <span>Regras</span>
            </button>
            <button onclick="scrollToSection('character')">
                üë§ <span>Personagem</span>
            </button>
            <button onclick="scrollToSection('calculator')">
                üßÆ <span>Calculadora</span>
            </button>
            <button onclick="scrollToSection('weight')">
                ‚öñÔ∏è <span>Peso</span>
            </button>
            <button onclick="openCharacterTab()">
                üìú <span>Ficha</span>
            </button>
        </div>

        <!-- Template PDF (oculto) -->
        <div id="pdf-sheet" style="display:none;"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
